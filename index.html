<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#5D4037" id="themeColor">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="brown-translucent">
  <meta name="apple-mobile-web-app-title" content="Daily Brew">
  <meta name="description" content="A cozy habit tracker and daily schedule app">
  
  <title>My Daily Brew</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
  <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Cormorant+Garamond:wght@400;500;600;700&family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    html, body, #root { height: 100%; width: 100%; overflow-x: hidden; }
    body { font-family: 'Cormorant Garamond', Georgia, serif; min-height: 100vh; min-height: -webkit-fill-available; transition: background 0.3s ease; }
    
    .loading-screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; background: linear-gradient(180deg, #F5E6D3 0%, #FDFBF7 50%, #F5E6D3 100%); }
    .loading-screen.hidden { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    .loading-icon { font-size: 48px; animation: steam 1.5s ease-in-out infinite; }
    @keyframes steam { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .loading-text { font-family: 'Caveat', cursive; font-size: 24px; color: #5D4037; margin-top: 16px; }
    
    .install-banner { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(145deg, #5D4037 0%, #4E342E 100%); color: #FFF8F0; padding: 16px; padding-bottom: max(16px, env(safe-area-inset-bottom)); display: flex; align-items: center; justify-content: space-between; gap: 12px; z-index: 1000; box-shadow: 0 -4px 20px rgba(0,0,0,0.2); transform: translateY(100%); transition: transform 0.3s ease; }
    .install-banner.show { transform: translateY(0); }
    .notification-banner { position: fixed; top: 0; left: 0; right: 0; background: linear-gradient(145deg, #D4A574 0%, #C4946A 100%); color: #3E2723; padding: 12px 16px; padding-top: max(12px, env(safe-area-inset-top)); display: flex; align-items: center; justify-content: space-between; gap: 12px; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.15); transform: translateY(-100%); transition: transform 0.3s ease; }
    .notification-banner.show { transform: translateY(0); }
    .banner-content { display: flex; align-items: center; gap: 12px; flex: 1; }
    .banner-btn { border: none; padding: 10px 20px; border-radius: 12px; font-family: 'Lora', serif; font-weight: 600; font-size: 14px; cursor: pointer; }
    .close-banner { background: none; border: none; font-size: 24px; cursor: pointer; padding: 4px; opacity: 0.7; }
    .update-toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: linear-gradient(145deg, #5D4037 0%, #4E342E 100%); color: #FFF8F0; padding: 12px 20px; border-radius: 12px; font-family: 'Lora', serif; font-size: 14px; z-index: 1001; box-shadow: 0 4px 20px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px; transition: transform 0.3s ease; }
    .update-toast.show { transform: translateX(-50%) translateY(0); }
    .update-toast button { background: #C4A77D; color: #3E2723; border: none; padding: 6px 12px; border-radius: 8px; font-weight: 600; cursor: pointer; }
  </style>
</head>
<body>
  <div id="root"></div>
  <div class="loading-screen" id="loadingScreen"><div class="loading-icon">‚òï</div><div class="loading-text">Brewing your day...</div></div>
  <div class="notification-banner" id="notificationBanner"><div class="banner-content"><span style="font-size:24px">üîî</span><p style="font-family:'Lora',serif;font-size:13px">Enable notifications for reminders!</p></div><button class="banner-btn" id="enableNotificationsBtn" style="background:#5D4037;color:#FFF8F0">Enable</button><button class="close-banner" id="closeNotificationBanner" style="color:#5D4037">√ó</button></div>
  <div class="install-banner" id="installBanner"><div class="banner-content"><span style="font-size:32px">‚òï</span><div><h3 style="font-family:'Caveat',cursive;font-size:18px;margin-bottom:2px">Install Daily Brew</h3><p style="font-family:'Lora',serif;font-size:12px;opacity:0.8">Add to home screen</p></div></div><button class="banner-btn" id="installBtn" style="background:linear-gradient(145deg,#C4A77D 0%,#A8956D 100%);color:#3E2723">Install</button><button class="close-banner" id="closeBanner" style="color:#FFF8F0">√ó</button></div>
  <div class="update-toast" id="updateToast"><span>‚ú® Update available!</span><button id="updateBtn">Refresh</button></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef, useMemo } = React;

    const STORAGE_KEY = 'dailyBrewData';
    const THEME_KEY = 'dailyBrewTheme';
    const ONBOARDING_KEY = 'dailyBrewOnboardingSeen';
    const MOOD_KEY = 'dailyBrewMoods';

    const themes = {
      light: {
        name: 'Light Brew', icon: '‚òÄÔ∏è',
        bg: 'linear-gradient(180deg, #F5E6D3 0%, #FDFBF7 50%, #F5E6D3 100%)',
        cardBg: 'linear-gradient(145deg, #FDFBF7 0%, #FBF7F0 100%)',
        cardBorder: '#E8DCC8', text: '#5D4037', textSecondary: '#8B7355', textMuted: '#C4A77D',
        accent: '#8B7355', accentLight: '#D4C4A8',
        accentGradient: 'linear-gradient(145deg, #8B7355 0%, #6B5344 100%)',
        inputBg: '#FDFBF7', inputBorder: '#D4C4A8', progressBg: '#F0E6D8',
        streakGradient: 'linear-gradient(145deg, #D4A574 0%, #C4946A 100%)',
        navBg: 'rgba(253, 251, 247, 0.95)', modalOverlay: 'rgba(93, 64, 55, 0.85)',
        success: '#A8C5A0', danger: '#C5A0A0', warning: '#C5BCA0'
      },
      dark: {
        name: 'Dark Brew', icon: 'üåô',
        bg: 'linear-gradient(180deg, #1A1412 0%, #2D2320 50%, #1A1412 100%)',
        cardBg: 'linear-gradient(145deg, #2D2320 0%, #3D322E 100%)',
        cardBorder: '#4A3F3A', text: '#F5E6D3', textSecondary: '#C4A77D', textMuted: '#8B7355',
        accent: '#D4A574', accentLight: '#4A3F3A',
        accentGradient: 'linear-gradient(145deg, #D4A574 0%, #C4946A 100%)',
        inputBg: '#2D2320', inputBorder: '#4A3F3A', progressBg: '#3D322E',
        streakGradient: 'linear-gradient(145deg, #C4946A 0%, #A67B5B 100%)',
        navBg: 'rgba(45, 35, 32, 0.95)', modalOverlay: 'rgba(26, 20, 18, 0.9)',
        success: '#7A9A72', danger: '#9A7272', warning: '#9A9472'
      }
    };

    const habitIcons = { water: '‚òï', exercise: 'üö∂', reading: 'üìñ', sleep: 'üåô', healthy: 'ü•ê', study: 'üìù', creative: 'üé®', mindful: 'üçÉ', social: 'üí¨', clean: '‚ú®' };
    const moodEmojis = [ { emoji: 'üò¢', label: 'Sad', value: 1 }, { emoji: 'üòï', label: 'Meh', value: 2 }, { emoji: 'üòä', label: 'Good', value: 3 }, { emoji: 'üòÑ', label: 'Great', value: 4 }, { emoji: 'ü§©', label: 'Amazing', value: 5 } ];
    const priorityStyles = { high: { light: { bg: '#8B4513', text: '#FFF8F0' }, dark: { bg: '#C4946A', text: '#1A1412' } }, medium: { light: { bg: '#D2B48C', text: '#5D4037' }, dark: { bg: '#8B7355', text: '#F5E6D3' } }, low: { light: { bg: '#F5E6D3', text: '#8B7355' }, dark: { bg: '#4A3F3A', text: '#C4A77D' } } };

    const defaultHabits = [
      { id: 1, name: 'Drink 8 glasses of water', icon: 'water', completed: false, streak: 5 },
      { id: 2, name: '30 min exercise', icon: 'exercise', completed: false, streak: 12 },
      { id: 3, name: 'Read for 20 minutes', icon: 'reading', completed: true, streak: 8 },
    ];

    const defaultTasks = [
      { id: 1, text: 'Finish math homework', time: '16:00', priority: 'high', done: false, reminder: true },
      { id: 2, text: 'Practice guitar', time: '17:30', priority: 'medium', done: false, reminder: false },
    ];

    const formatTime12 = (t) => { if (!t || t === 'Anytime') return 'Anytime'; const [h, m] = t.split(':').map(Number); return `${h % 12 || 12}:${m.toString().padStart(2, '0')} ${h >= 12 ? 'PM' : 'AM'}`; };
    const formatTimer = (s) => { const m = Math.floor(s / 60); const sec = s % 60; return `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`; };
    const getDateKey = (d) => d.toISOString().split('T')[0];
    const isSameDay = (d1, d2) => getDateKey(d1) === getDateKey(d2);

    function loadData(key, fallback) { try { const d = localStorage.getItem(key); return d ? JSON.parse(d) : fallback; } catch { return fallback; } }
    function saveData(key, data) { try { localStorage.setItem(key, JSON.stringify(data)); } catch (e) { console.error('Save failed:', e); } }

    // Notification helpers
    const notifySupported = () => 'Notification' in window && 'serviceWorker' in navigator;
    const getNotifyPerm = () => notifySupported() ? Notification.permission : 'unsupported';

    function App() {
      const [theme, setTheme] = useState(() => loadData(THEME_KEY, 'light'));
      const [activeTab, setActiveTab] = useState('today');
      const [habits, setHabits] = useState(() => loadData(STORAGE_KEY, { habits: defaultHabits }).habits || defaultHabits);
      const [tasks, setTasks] = useState(() => loadData(STORAGE_KEY, { tasks: defaultTasks }).tasks || defaultTasks);
      const [moods, setMoods] = useState(() => loadData(MOOD_KEY, {}));
      const [showOnboarding, setShowOnboarding] = useState(() => !localStorage.getItem(ONBOARDING_KEY));
      const [onboardingStep, setOnboardingStep] = useState(0);
      const [showAddHabit, setShowAddHabit] = useState(false);
      const [showAddTask, setShowAddTask] = useState(false);
      const [newHabit, setNewHabit] = useState('');
      const [newHabitIcon, setNewHabitIcon] = useState('water');
      const [newTask, setNewTask] = useState('');
      const [newTaskTime, setNewTaskTime] = useState('');
      const [newTaskPriority, setNewTaskPriority] = useState('medium');
      const [newTaskReminder, setNewTaskReminder] = useState(true);
      const [calendarDate, setCalendarDate] = useState(new Date());
      const [timerSeconds, setTimerSeconds] = useState(25 * 60);
      const [timerRunning, setTimerRunning] = useState(false);
      const [timerTask, setTimerTask] = useState(null);
      const [showTimerPicker, setShowTimerPicker] = useState(false);
      const [customMinutes, setCustomMinutes] = useState(25);
      const timerRef = useRef(null);

      const t = themes[theme];
      const today = new Date();
      const todayKey = getDateKey(today);

      // Save data
      useEffect(() => { saveData(STORAGE_KEY, { habits, tasks, lastDate: todayKey }); }, [habits, tasks]);
      useEffect(() => { saveData(MOOD_KEY, moods); }, [moods]);
      useEffect(() => { saveData(THEME_KEY, theme); document.getElementById('themeColor').content = theme === 'dark' ? '#1A1412' : '#5D4037'; }, [theme]);

      // Timer logic
      useEffect(() => {
        if (timerRunning && timerSeconds > 0) {
          timerRef.current = setTimeout(() => setTimerSeconds(s => s - 1), 1000);
        } else if (timerRunning && timerSeconds === 0) {
          setTimerRunning(false);
          if (notifySupported() && getNotifyPerm() === 'granted') {
            navigator.serviceWorker.ready.then(reg => {
              reg.showNotification('‚òï Timer Complete!', { body: timerTask ? `Finished: ${timerTask}` : 'Your focus session is done!', icon: 'icons/icon-192.png', vibrate: [200, 100, 200, 100, 200], requireInteraction: true });
            });
          }
        }
        return () => clearTimeout(timerRef.current);
      }, [timerRunning, timerSeconds, timerTask]);

      const toggleTheme = () => setTheme(theme === 'light' ? 'dark' : 'light');
      const dismissOnboarding = () => { localStorage.setItem(ONBOARDING_KEY, 'true'); setShowOnboarding(false); };

      const toggleHabit = (id) => setHabits(habits.map(h => h.id === id ? { ...h, completed: !h.completed, streak: !h.completed ? h.streak + 1 : Math.max(0, h.streak - 1) } : h));
      const toggleTask = (id) => setTasks(tasks.map(t => t.id === id ? { ...t, done: !t.done } : t));
      const toggleReminder = (id) => setTasks(tasks.map(t => t.id === id ? { ...t, reminder: !t.reminder } : t));
      const deleteHabit = (id) => setHabits(habits.filter(h => h.id !== id));
      const deleteTask = (id) => setTasks(tasks.filter(t => t.id !== id));

      const addHabit = () => { if (newHabit.trim()) { setHabits([...habits, { id: Date.now(), name: newHabit, icon: newHabitIcon, completed: false, streak: 0 }]); setNewHabit(''); setNewHabitIcon('water'); setShowAddHabit(false); } };
      const addTask = () => { if (newTask.trim()) { setTasks([...tasks, { id: Date.now(), text: newTask, time: newTaskTime || 'Anytime', priority: newTaskPriority, done: false, reminder: newTaskReminder && !!newTaskTime }]); setNewTask(''); setNewTaskTime(''); setNewTaskPriority('medium'); setShowAddTask(false); } };

      const setMood = (value) => setMoods({ ...moods, [todayKey]: { value, timestamp: Date.now() } });
      const todayMood = moods[todayKey];

      const startTimer = (mins, taskName = null) => { setTimerSeconds(mins * 60); setTimerTask(taskName); setTimerRunning(true); setShowTimerPicker(false); };
      const pauseTimer = () => setTimerRunning(false);
      const resetTimer = () => { setTimerRunning(false); setTimerSeconds(25 * 60); setTimerTask(null); };

      const completedHabits = habits.filter(h => h.completed).length;
      const completedTasks = tasks.filter(t => t.done).length;
      const totalProgress = Math.round(((completedHabits + completedTasks) / Math.max(1, habits.length + tasks.length)) * 100);

      // Calendar helpers
      const calMonth = calendarDate.getMonth();
      const calYear = calendarDate.getFullYear();
      const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
      const firstDayOfMonth = new Date(calYear, calMonth, 1).getDay();
      const calendarDays = useMemo(() => {
        const days = [];
        for (let i = 0; i < firstDayOfMonth; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(new Date(calYear, calMonth, i));
        return days;
      }, [calYear, calMonth, daysInMonth, firstDayOfMonth]);

      // Stats calculations
      const monthStats = useMemo(() => {
        const monthMoods = Object.entries(moods).filter(([k]) => k.startsWith(`${calYear}-${String(calMonth + 1).padStart(2, '0')}`));
        const avgMood = monthMoods.length ? (monthMoods.reduce((sum, [, v]) => sum + v.value, 0) / monthMoods.length).toFixed(1) : null;
        const moodCounts = monthMoods.reduce((acc, [, v]) => { acc[v.value] = (acc[v.value] || 0) + 1; return acc; }, {});
        return { avgMood, moodCounts, totalMoodEntries: monthMoods.length };
      }, [moods, calYear, calMonth]);

      const styles = {
        container: { minHeight: '100vh', width: '100%', background: t.bg, fontFamily: "'Cormorant Garamond', Georgia, serif", transition: 'all 0.3s ease' },
        inner: { maxWidth: '28rem', margin: '0 auto', minHeight: '100vh', display: 'flex', flexDirection: 'column', padding: '20px 16px 100px', paddingBottom: 'max(100px, env(safe-area-inset-bottom))' },
        card: { background: t.cardBg, border: `1px solid ${t.cardBorder}`, borderRadius: '1rem', padding: '16px', marginBottom: '12px', boxShadow: '0 4px 20px rgba(0,0,0,0.08)' },
        btn: { background: t.accentGradient, color: theme === 'dark' ? '#1A1412' : '#FFF8F0', border: 'none', borderRadius: '12px', padding: '12px 20px', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer', transition: 'all 0.2s' },
        input: { background: t.inputBg, border: `1px solid ${t.inputBorder}`, borderRadius: '12px', padding: '12px 16px', fontFamily: "'Lora', serif", fontSize: '1rem', color: t.text, width: '100%', outline: 'none' },
        nav: { position: 'fixed', bottom: 0, left: 0, right: 0, background: t.navBg, borderTop: `1px solid ${t.cardBorder}`, display: 'flex', justifyContent: 'space-around', padding: '8px 0', paddingBottom: 'max(8px, env(safe-area-inset-bottom))', backdropFilter: 'blur(20px)', zIndex: 100 },
        navItem: (active) => ({ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '2px', padding: '8px 12px', borderRadius: '12px', background: active ? t.accentGradient : 'transparent', color: active ? (theme === 'dark' ? '#1A1412' : '#FFF8F0') : t.textSecondary, border: 'none', cursor: 'pointer', fontFamily: "'Lora', serif", fontSize: '10px', fontWeight: active ? 600 : 400, transition: 'all 0.2s' }),
      };

      return (
        <div style={styles.container}>
          <style>{`
            .handwritten { font-family: 'Caveat', cursive; }
            .body-text { font-family: 'Lora', serif; }
            .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
            .hide-scrollbar::-webkit-scrollbar { display: none; }
            .card-hover { transition: transform 0.2s; }
            .card-hover:active { transform: scale(0.98); }
            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
            @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
            .fade-in { animation: fadeIn 0.3s ease; }
            .slide-up { animation: slideUp 0.4s ease; }
          `}</style>

          <div style={styles.inner} className="hide-scrollbar">
            {/* Header */}
            <header style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
              <div>
                <h1 className="handwritten" style={{ fontSize: '2rem', color: t.text, margin: 0 }}>‚òï My Daily Brew</h1>
                <p className="body-text" style={{ fontSize: '0.875rem', color: t.textSecondary, marginTop: '4px' }}>
                  {today.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                </p>
              </div>
              <button onClick={toggleTheme} style={{ background: t.accentGradient, border: 'none', borderRadius: '12px', padding: '10px 14px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px', color: theme === 'dark' ? '#1A1412' : '#FFF8F0', fontFamily: "'Lora', serif", fontSize: '12px', fontWeight: 600 }}>
                {t.icon} {theme === 'light' ? 'Dark' : 'Light'}
              </button>
            </header>

            {/* Today Tab */}
            {activeTab === 'today' && (
              <div className="fade-in">
                {/* Progress */}
                <div style={styles.card}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                    <div>
                      <p className="body-text" style={{ fontSize: '0.75rem', textTransform: 'uppercase', letterSpacing: '0.1em', color: t.textSecondary }}>Today's Progress</p>
                      <p style={{ fontSize: '2.5rem', fontWeight: 600, color: t.text }}>{totalProgress}%</p>
                    </div>
                    <div className="body-text" style={{ textAlign: 'right', fontSize: '0.875rem', color: t.textSecondary }}>
                      <p><span style={{ color: t.text, fontWeight: 600 }}>{completedHabits}</span>/{habits.length} habits</p>
                      <p><span style={{ color: t.text, fontWeight: 600 }}>{completedTasks}</span>/{tasks.length} tasks</p>
                    </div>
                  </div>
                  <div style={{ height: '12px', borderRadius: '999px', background: t.progressBg, overflow: 'hidden' }}>
                    <div style={{ height: '100%', width: `${totalProgress}%`, background: t.accentGradient, borderRadius: '999px', transition: 'width 0.5s ease' }} />
                  </div>
                </div>

                {/* Mood Tracker */}
                <div style={styles.card}>
                  <p className="body-text" style={{ fontSize: '0.875rem', color: t.textSecondary, marginBottom: '12px' }}>How are you feeling today?</p>
                  <div style={{ display: 'flex', justifyContent: 'space-between', gap: '8px' }}>
                    {moodEmojis.map(m => (
                      <button key={m.value} onClick={() => setMood(m.value)} style={{ flex: 1, padding: '12px 8px', borderRadius: '12px', border: todayMood?.value === m.value ? `2px solid ${t.accent}` : `1px solid ${t.cardBorder}`, background: todayMood?.value === m.value ? t.accentLight : 'transparent', cursor: 'pointer', transition: 'all 0.2s' }}>
                        <div style={{ fontSize: '1.5rem' }}>{m.emoji}</div>
                        <div className="body-text" style={{ fontSize: '0.65rem', color: t.textSecondary, marginTop: '4px' }}>{m.label}</div>
                      </button>
                    ))}
                  </div>
                </div>

                {/* Habits */}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', margin: '20px 0 12px' }}>
                  <h2 style={{ fontSize: '1.125rem', fontWeight: 600, color: t.text }}>‚≠ê Daily Rituals</h2>
                  <button onClick={() => setShowAddHabit(!showAddHabit)} style={{ ...styles.btn, padding: '8px 14px', fontSize: '1.25rem', lineHeight: 1 }}>+</button>
                </div>

                {showAddHabit && (
                  <div style={{ ...styles.card, marginBottom: '12px' }} className="slide-up">
                    <p className="handwritten" style={{ fontSize: '1rem', color: t.textSecondary, marginBottom: '8px' }}>Choose an icon:</p>
                    <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap', marginBottom: '12px' }}>
                      {Object.entries(habitIcons).map(([k, v]) => (
                        <button key={k} onClick={() => setNewHabitIcon(k)} style={{ width: '40px', height: '40px', borderRadius: '10px', border: 'none', background: newHabitIcon === k ? t.accentGradient : t.progressBg, fontSize: '1.125rem', cursor: 'pointer' }}>{v}</button>
                      ))}
                    </div>
                    <input value={newHabit} onChange={e => setNewHabit(e.target.value)} placeholder="New habit..." style={{ ...styles.input, marginBottom: '12px' }} onKeyPress={e => e.key === 'Enter' && addHabit()} />
                    <button onClick={addHabit} style={{ ...styles.btn, width: '100%' }}>Add Habit</button>
                  </div>
                )}

                {habits.map(habit => (
                  <div key={habit.id} style={{ ...styles.card, display: 'flex', alignItems: 'center', gap: '12px', borderColor: habit.completed ? t.success : t.cardBorder }} className="card-hover">
                    <button onClick={() => toggleHabit(habit.id)} style={{ width: '44px', height: '44px', borderRadius: '12px', border: habit.completed ? 'none' : `2px solid ${t.inputBorder}`, background: habit.completed ? t.accentGradient : t.progressBg, color: habit.completed ? (theme === 'dark' ? '#1A1412' : '#FFF8F0') : t.text, fontSize: '1.125rem', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      {habit.completed ? '‚úì' : habitIcons[habit.icon]}
                    </button>
                    <div style={{ flex: 1, minWidth: 0 }}>
                      <p className="body-text" style={{ fontWeight: 500, color: habit.completed ? t.textMuted : t.text, textDecoration: habit.completed ? 'line-through' : 'none', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{habit.name}</p>
                      <span className="body-text" style={{ fontSize: '0.7rem', padding: '2px 8px', borderRadius: '999px', background: t.streakGradient, color: theme === 'dark' ? '#1A1412' : '#FFF8F0' }}>üî• {habit.streak} days</span>
                    </div>
                    <button onClick={() => deleteHabit(habit.id)} style={{ background: 'none', border: 'none', color: t.textMuted, fontSize: '1.25rem', cursor: 'pointer', padding: '8px' }}>√ó</button>
                  </div>
                ))}

                {/* Tasks */}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', margin: '20px 0 12px' }}>
                  <h2 style={{ fontSize: '1.125rem', fontWeight: 600, color: t.text }}>‚úì To-Do List</h2>
                  <button onClick={() => setShowAddTask(!showAddTask)} style={{ ...styles.btn, padding: '8px 14px', fontSize: '1.25rem', lineHeight: 1 }}>+</button>
                </div>

                {showAddTask && (
                  <div style={{ ...styles.card, marginBottom: '12px' }} className="slide-up">
                    <input value={newTask} onChange={e => setNewTask(e.target.value)} placeholder="What needs to be done?" style={{ ...styles.input, marginBottom: '12px' }} onKeyPress={e => e.key === 'Enter' && addTask()} />
                    <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                      <input type="time" value={newTaskTime} onChange={e => setNewTaskTime(e.target.value)} style={{ ...styles.input, flex: 1 }} />
                      <select value={newTaskPriority} onChange={e => setNewTaskPriority(e.target.value)} style={{ ...styles.input, flex: 1 }}>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                      </select>
                    </div>
                    <label className="body-text" style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '12px', color: t.textSecondary, fontSize: '0.875rem' }}>
                      <input type="checkbox" checked={newTaskReminder} onChange={e => setNewTaskReminder(e.target.checked)} disabled={!newTaskTime} style={{ accentColor: t.accent }} />
                      üîî Remind me at this time
                    </label>
                    <button onClick={addTask} style={{ ...styles.btn, width: '100%' }}>Add Task</button>
                  </div>
                )}

                {tasks.sort((a, b) => ({ high: 0, medium: 1, low: 2 })[a.priority] - ({ high: 0, medium: 1, low: 2 })[b.priority]).map(task => (
                  <div key={task.id} style={{ ...styles.card, display: 'flex', alignItems: 'center', gap: '12px', opacity: task.done ? 0.7 : 1 }} className="card-hover">
                    <button onClick={() => toggleTask(task.id)} style={{ width: '40px', height: '40px', borderRadius: '12px', border: task.done ? 'none' : `2px solid ${t.inputBorder}`, background: task.done ? t.accentGradient : t.progressBg, color: task.done ? (theme === 'dark' ? '#1A1412' : '#FFF8F0') : t.text, fontSize: '1rem', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>
                      {task.done && '‚úì'}
                    </button>
                    <div style={{ flex: 1, minWidth: 0 }}>
                      <p className="body-text" style={{ fontWeight: 500, color: task.done ? t.textMuted : t.text, textDecoration: task.done ? 'line-through' : 'none', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{task.text}</p>
                      <div style={{ display: 'flex', gap: '8px', alignItems: 'center', marginTop: '4px', flexWrap: 'wrap' }}>
                        <span className="body-text" style={{ fontSize: '0.7rem', color: t.textSecondary }}>üïê {formatTime12(task.time)}</span>
                        <span className="body-text" style={{ fontSize: '0.65rem', padding: '2px 8px', borderRadius: '999px', background: priorityStyles[task.priority][theme].bg, color: priorityStyles[task.priority][theme].text }}>{task.priority}</span>
                      </div>
                    </div>
                    {task.time && task.time !== 'Anytime' && (
                      <button onClick={() => toggleReminder(task.id)} style={{ width: '28px', height: '28px', borderRadius: '8px', border: 'none', background: task.reminder ? t.streakGradient : t.progressBg, fontSize: '0.875rem', cursor: 'pointer' }}>{task.reminder ? 'üîî' : 'üîï'}</button>
                    )}
                    <button onClick={() => deleteTask(task.id)} style={{ background: 'none', border: 'none', color: t.textMuted, fontSize: '1.25rem', cursor: 'pointer', padding: '8px' }}>√ó</button>
                  </div>
                ))}

                {/* Motivational Footer */}
                <div style={{ ...styles.card, textAlign: 'center', marginTop: '20px' }}>
                  <span style={{ fontSize: '1.5rem' }}>üçÇ</span>
                  <p className="handwritten" style={{ fontSize: '1.25rem', color: t.textSecondary, marginTop: '8px' }}>
                    {totalProgress === 100 ? "You've done beautifully today ‚ú®" : totalProgress > 50 ? "Keep brewing greatness ‚òï" : "One sip at a time, dear üçÉ"}
                  </p>
                </div>
              </div>
            )}

            {/* Timer Tab */}
            {activeTab === 'timer' && (
              <div className="fade-in">
                <div style={{ ...styles.card, textAlign: 'center', padding: '32px 20px' }}>
                  <h2 className="handwritten" style={{ fontSize: '1.75rem', color: t.text, marginBottom: '8px' }}>‚è±Ô∏è Focus Timer</h2>
                  <p className="body-text" style={{ fontSize: '0.875rem', color: t.textSecondary, marginBottom: '24px' }}>
                    {timerTask ? `Working on: ${timerTask}` : 'Stay focused, one brew at a time'}
                  </p>
                  
                  <div style={{ fontSize: '4rem', fontWeight: 300, color: t.text, fontFamily: "'Lora', serif", marginBottom: '24px' }}>
                    {formatTimer(timerSeconds)}
                  </div>

                  <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', marginBottom: '24px' }}>
                    {!timerRunning ? (
                      <button onClick={() => timerSeconds > 0 ? setTimerRunning(true) : setShowTimerPicker(true)} style={{ ...styles.btn, padding: '14px 32px', fontSize: '1rem' }}>
                        {timerSeconds > 0 ? '‚ñ∂ Start' : 'Set Timer'}
                      </button>
                    ) : (
                      <button onClick={pauseTimer} style={{ ...styles.btn, padding: '14px 32px', fontSize: '1rem' }}>‚è∏ Pause</button>
                    )}
                    <button onClick={resetTimer} style={{ ...styles.btn, padding: '14px 20px', background: t.progressBg, color: t.text }}>‚Ü∫ Reset</button>
                  </div>

                  <div style={{ display: 'flex', gap: '8px', justifyContent: 'center', flexWrap: 'wrap' }}>
                    {[5, 15, 25, 45].map(m => (
                      <button key={m} onClick={() => startTimer(m)} style={{ padding: '10px 16px', borderRadius: '10px', border: `1px solid ${t.cardBorder}`, background: 'transparent', color: t.textSecondary, fontFamily: "'Lora', serif", fontSize: '0.875rem', cursor: 'pointer' }}>{m} min</button>
                    ))}
                  </div>
                </div>

                {/* Quick start from tasks */}
                <h3 className="body-text" style={{ fontSize: '1rem', color: t.textSecondary, margin: '20px 0 12px' }}>Start timer for a task:</h3>
                {tasks.filter(t => !t.done).map(task => (
                  <div key={task.id} style={{ ...styles.card, display: 'flex', alignItems: 'center', gap: '12px' }} className="card-hover">
                    <div style={{ flex: 1 }}>
                      <p className="body-text" style={{ fontWeight: 500, color: t.text }}>{task.text}</p>
                    </div>
                    <button onClick={() => startTimer(25, task.text)} style={{ ...styles.btn, padding: '8px 16px', fontSize: '0.875rem' }}>25m ‚ñ∂</button>
                  </div>
                ))}
              </div>
            )}

            {/* Calendar Tab */}
            {activeTab === 'calendar' && (
              <div className="fade-in">
                <div style={{ ...styles.card }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                    <button onClick={() => setCalendarDate(new Date(calYear, calMonth - 1, 1))} style={{ background: 'none', border: 'none', color: t.textSecondary, fontSize: '1.25rem', cursor: 'pointer', padding: '8px' }}>‚Äπ</button>
                    <h2 className="body-text" style={{ fontSize: '1.125rem', fontWeight: 600, color: t.text }}>
                      {calendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                    </h2>
                    <button onClick={() => setCalendarDate(new Date(calYear, calMonth + 1, 1))} style={{ background: 'none', border: 'none', color: t.textSecondary, fontSize: '1.25rem', cursor: 'pointer', padding: '8px' }}>‚Ä∫</button>
                  </div>

                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px', marginBottom: '8px' }}>
                    {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => (
                      <div key={i} className="body-text" style={{ textAlign: 'center', fontSize: '0.7rem', color: t.textMuted, padding: '4px' }}>{d}</div>
                    ))}
                  </div>

                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gap: '4px' }}>
                    {calendarDays.map((day, i) => {
                      if (!day) return <div key={i} />;
                      const dateKey = getDateKey(day);
                      const dayMood = moods[dateKey];
                      const isToday = isSameDay(day, today);
                      return (
                        <div key={i} style={{ aspectRatio: '1', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', borderRadius: '10px', background: isToday ? t.accentGradient : dayMood ? t.accentLight : 'transparent', border: isToday ? 'none' : `1px solid ${t.cardBorder}`, cursor: 'pointer' }}>
                          <span className="body-text" style={{ fontSize: '0.8rem', color: isToday ? (theme === 'dark' ? '#1A1412' : '#FFF8F0') : t.text, fontWeight: isToday ? 600 : 400 }}>{day.getDate()}</span>
                          {dayMood && <span style={{ fontSize: '0.6rem' }}>{moodEmojis.find(m => m.value === dayMood.value)?.emoji}</span>}
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Mood Legend */}
                <div style={{ ...styles.card }}>
                  <p className="body-text" style={{ fontSize: '0.875rem', color: t.textSecondary, marginBottom: '12px' }}>Mood Legend</p>
                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                    {moodEmojis.map(m => (
                      <div key={m.value} style={{ textAlign: 'center' }}>
                        <div style={{ fontSize: '1.25rem' }}>{m.emoji}</div>
                        <div className="body-text" style={{ fontSize: '0.65rem', color: t.textMuted }}>{m.label}</div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* Stats Tab */}
            {activeTab === 'stats' && (
              <div className="fade-in">
                <div style={{ ...styles.card }}>
                  <h2 className="body-text" style={{ fontSize: '1rem', fontWeight: 600, color: t.text, marginBottom: '16px' }}>üìä {calendarDate.toLocaleDateString('en-US', { month: 'long' })} Statistics</h2>
                  
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '16px' }}>
                    <div style={{ background: t.progressBg, borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                      <p style={{ fontSize: '2rem', fontWeight: 600, color: t.text }}>{monthStats.avgMood || '‚Äî'}</p>
                      <p className="body-text" style={{ fontSize: '0.75rem', color: t.textSecondary }}>Avg Mood</p>
                    </div>
                    <div style={{ background: t.progressBg, borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                      <p style={{ fontSize: '2rem', fontWeight: 600, color: t.text }}>{monthStats.totalMoodEntries}</p>
                      <p className="body-text" style={{ fontSize: '0.75rem', color: t.textSecondary }}>Days Tracked</p>
                    </div>
                  </div>

                  {/* Mood Distribution */}
                  <p className="body-text" style={{ fontSize: '0.875rem', color: t.textSecondary, marginBottom: '8px' }}>Mood Distribution</p>
                  <div style={{ display: 'flex', gap: '4px', marginBottom: '16px' }}>
                    {moodEmojis.map(m => {
                      const count = monthStats.moodCounts[m.value] || 0;
                      const pct = monthStats.totalMoodEntries ? (count / monthStats.totalMoodEntries) * 100 : 0;
                      return (
                        <div key={m.value} style={{ flex: 1, textAlign: 'center' }}>
                          <div style={{ height: '60px', background: t.progressBg, borderRadius: '8px', display: 'flex', alignItems: 'flex-end', overflow: 'hidden' }}>
                            <div style={{ width: '100%', height: `${pct}%`, background: t.accentGradient, borderRadius: '8px 8px 0 0', transition: 'height 0.3s ease' }} />
                          </div>
                          <div style={{ marginTop: '4px', fontSize: '0.9rem' }}>{m.emoji}</div>
                          <div className="body-text" style={{ fontSize: '0.65rem', color: t.textMuted }}>{count}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>

                {/* Habit Stats */}
                <div style={{ ...styles.card }}>
                  <h3 className="body-text" style={{ fontSize: '1rem', fontWeight: 600, color: t.text, marginBottom: '12px' }}>üî• Habit Streaks</h3>
                  {habits.sort((a, b) => b.streak - a.streak).map(habit => (
                    <div key={habit.id} style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px' }}>
                      <span style={{ fontSize: '1.25rem' }}>{habitIcons[habit.icon]}</span>
                      <div style={{ flex: 1 }}>
                        <p className="body-text" style={{ fontSize: '0.875rem', color: t.text }}>{habit.name}</p>
                        <div style={{ height: '6px', background: t.progressBg, borderRadius: '999px', marginTop: '4px', overflow: 'hidden' }}>
                          <div style={{ height: '100%', width: `${Math.min(100, habit.streak * 3.33)}%`, background: t.streakGradient, borderRadius: '999px' }} />
                        </div>
                      </div>
                      <span className="body-text" style={{ fontSize: '0.875rem', fontWeight: 600, color: t.accent }}>{habit.streak}d</span>
                    </div>
                  ))}
                </div>

                {/* Task Stats */}
                <div style={{ ...styles.card }}>
                  <h3 className="body-text" style={{ fontSize: '1rem', fontWeight: 600, color: t.text, marginBottom: '12px' }}>‚úì Task Completion</h3>
                  <div style={{ display: 'flex', justifyContent: 'space-around' }}>
                    {['high', 'medium', 'low'].map(p => {
                      const total = tasks.filter(t => t.priority === p).length;
                      const done = tasks.filter(t => t.priority === p && t.done).length;
                      return (
                        <div key={p} style={{ textAlign: 'center' }}>
                          <div style={{ width: '50px', height: '50px', borderRadius: '50%', background: t.progressBg, display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 8px', border: `3px solid ${priorityStyles[p][theme].bg}` }}>
                            <span className="body-text" style={{ fontSize: '0.875rem', fontWeight: 600, color: t.text }}>{total ? Math.round((done / total) * 100) : 0}%</span>
                          </div>
                          <p className="body-text" style={{ fontSize: '0.75rem', color: t.textSecondary, textTransform: 'capitalize' }}>{p}</p>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Bottom Navigation */}
          <nav style={styles.nav}>
            {[
              { id: 'today', icon: 'üìÖ', label: 'Today' },
              { id: 'timer', icon: '‚è±Ô∏è', label: 'Timer' },
              { id: 'calendar', icon: 'üìÜ', label: 'Calendar' },
              { id: 'stats', icon: 'üìä', label: 'Stats' },
            ].map(tab => (
              <button key={tab.id} onClick={() => setActiveTab(tab.id)} style={styles.navItem(activeTab === tab.id)}>
                <span style={{ fontSize: '1.25rem' }}>{tab.icon}</span>
                <span>{tab.label}</span>
              </button>
            ))}
          </nav>

          {/* Onboarding Modal */}
          {showOnboarding && (
            <div style={{ position: 'fixed', inset: 0, background: t.modalOverlay, backdropFilter: 'blur(8px)', zIndex: 2000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }} className="fade-in">
              <button onClick={dismissOnboarding} style={{ position: 'absolute', top: '16px', right: '16px', background: 'rgba(255,255,255,0.2)', border: 'none', color: '#FFF8F0', fontFamily: "'Lora', serif", fontSize: '13px', padding: '8px 16px', borderRadius: '20px', cursor: 'pointer' }}>Skip</button>
              
              <div style={{ background: themes.light.cardBg, borderRadius: '24px', maxWidth: '360px', width: '100%', maxHeight: '80vh', overflow: 'auto', boxShadow: '0 20px 60px rgba(0,0,0,0.3)' }} className="slide-up">
                {onboardingStep === 0 && (
                  <>
                    <div style={{ padding: '24px 24px 16px', textAlign: 'center', borderBottom: '1px solid #E8DCC8' }}>
                      <div style={{ fontSize: '48px', marginBottom: '12px' }}>‚òï</div>
                      <h2 className="handwritten" style={{ fontSize: '2rem', color: '#5D4037' }}>Welcome to Daily Brew!</h2>
                    </div>
                    <div style={{ padding: '20px 24px' }}>
                      <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '20px' }}>
                        {[0,1,2,3].map(i => <div key={i} style={{ width: i === onboardingStep ? '24px' : '8px', height: '8px', borderRadius: '4px', background: i === onboardingStep ? '#8B7355' : '#D4C4A8', transition: 'all 0.3s' }} />)}
                      </div>
                      <p className="body-text" style={{ color: '#6B5344', textAlign: 'center', marginBottom: '16px' }}>Your cozy companion for tracking habits, tasks, moods, and focus time!</p>
                      <div style={{ background: '#FFF8F0', border: '2px dashed #D4C4A8', borderRadius: '16px', padding: '16px', textAlign: 'center' }}>
                        <span style={{ fontSize: '32px' }}>üìÖ ‚è±Ô∏è üìä üòä</span>
                      </div>
                    </div>
                    <div style={{ padding: '16px 24px 24px' }}>
                      <button onClick={() => setOnboardingStep(1)} style={{ width: '100%', padding: '14px', borderRadius: '12px', background: 'linear-gradient(145deg, #8B7355 0%, #6B5344 100%)', color: '#FFF8F0', border: 'none', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>Get Started ‚Üí</button>
                    </div>
                  </>
                )}

                {onboardingStep === 1 && (
                  <>
                    <div style={{ padding: '24px 24px 16px', textAlign: 'center', borderBottom: '1px solid #E8DCC8' }}>
                      <div style={{ fontSize: '48px', marginBottom: '12px' }}>üîî</div>
                      <h2 className="handwritten" style={{ fontSize: '1.75rem', color: '#5D4037' }}>Task Reminders</h2>
                    </div>
                    <div style={{ padding: '20px 24px' }}>
                      <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '20px' }}>
                        {[0,1,2,3].map(i => <div key={i} style={{ width: i === onboardingStep ? '24px' : '8px', height: '8px', borderRadius: '4px', background: i === onboardingStep ? '#8B7355' : '#D4C4A8', transition: 'all 0.3s' }} />)}
                      </div>
                      <div style={{ background: '#FFF8F0', border: '2px dashed #D4C4A8', borderRadius: '16px', padding: '16px' }}>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '12px' }}><span>üïê</span><span className="body-text" style={{ color: '#5D4037', fontSize: '14px' }}>Set a <strong>time</strong> for your task</span></div>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '12px' }}><span>‚òëÔ∏è</span><span className="body-text" style={{ color: '#5D4037', fontSize: '14px' }}>Enable <strong>"Remind me"</strong></span></div>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}><span>üì±</span><span className="body-text" style={{ color: '#5D4037', fontSize: '14px' }}>Get notified on your lock screen!</span></div>
                      </div>
                    </div>
                    <div style={{ padding: '16px 24px 24px', display: 'flex', gap: '12px' }}>
                      <button onClick={() => setOnboardingStep(0)} style={{ flex: 1, padding: '14px', borderRadius: '12px', background: 'transparent', border: '2px solid #D4C4A8', color: '#8B7355', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>‚Üê Back</button>
                      <button onClick={() => setOnboardingStep(2)} style={{ flex: 1, padding: '14px', borderRadius: '12px', background: 'linear-gradient(145deg, #8B7355 0%, #6B5344 100%)', color: '#FFF8F0', border: 'none', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>Next ‚Üí</button>
                    </div>
                  </>
                )}

                {onboardingStep === 2 && (
                  <>
                    <div style={{ padding: '24px 24px 16px', textAlign: 'center', borderBottom: '1px solid #E8DCC8' }}>
                      <div style={{ fontSize: '48px', marginBottom: '12px' }}>‚è±Ô∏è</div>
                      <h2 className="handwritten" style={{ fontSize: '1.75rem', color: '#5D4037' }}>Focus Timer</h2>
                    </div>
                    <div style={{ padding: '20px 24px' }}>
                      <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '20px' }}>
                        {[0,1,2,3].map(i => <div key={i} style={{ width: i === onboardingStep ? '24px' : '8px', height: '8px', borderRadius: '4px', background: i === onboardingStep ? '#8B7355' : '#D4C4A8', transition: 'all 0.3s' }} />)}
                      </div>
                      <p className="body-text" style={{ color: '#6B5344', textAlign: 'center', marginBottom: '16px' }}>Use the timer to focus on tasks:</p>
                      <div style={{ background: '#FFF8F0', border: '2px dashed #D4C4A8', borderRadius: '16px', padding: '16px' }}>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '12px' }}><span>‚è±Ô∏è</span><span className="body-text" style={{ color: '#5D4037', fontSize: '14px' }}>Choose preset times or custom</span></div>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '12px' }}><span>üìã</span><span className="body-text" style={{ color: '#5D4037', fontSize: '14px' }}>Start timer directly from a task</span></div>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}><span>üîî</span><span className="body-text" style={{ color: '#5D4037', fontSize: '14px' }}>Get notified when time's up!</span></div>
                      </div>
                    </div>
                    <div style={{ padding: '16px 24px 24px', display: 'flex', gap: '12px' }}>
                      <button onClick={() => setOnboardingStep(1)} style={{ flex: 1, padding: '14px', borderRadius: '12px', background: 'transparent', border: '2px solid #D4C4A8', color: '#8B7355', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>‚Üê Back</button>
                      <button onClick={() => setOnboardingStep(3)} style={{ flex: 1, padding: '14px', borderRadius: '12px', background: 'linear-gradient(145deg, #8B7355 0%, #6B5344 100%)', color: '#FFF8F0', border: 'none', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>Next ‚Üí</button>
                    </div>
                  </>
                )}

                {onboardingStep === 3 && (
                  <>
                    <div style={{ padding: '24px 24px 16px', textAlign: 'center', borderBottom: '1px solid #E8DCC8' }}>
                      <div style={{ fontSize: '48px', marginBottom: '12px' }}>üåô</div>
                      <h2 className="handwritten" style={{ fontSize: '1.75rem', color: '#5D4037' }}>Light & Dark Brew</h2>
                    </div>
                    <div style={{ padding: '20px 24px' }}>
                      <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '20px' }}>
                        {[0,1,2,3].map(i => <div key={i} style={{ width: i === onboardingStep ? '24px' : '8px', height: '8px', borderRadius: '4px', background: i === onboardingStep ? '#8B7355' : '#D4C4A8', transition: 'all 0.3s' }} />)}
                      </div>
                      <p className="body-text" style={{ color: '#6B5344', textAlign: 'center', marginBottom: '16px' }}>Switch themes anytime!</p>
                      <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', marginBottom: '16px' }}>
                        <div style={{ padding: '16px 24px', borderRadius: '12px', background: '#F5E6D3', textAlign: 'center' }}>
                          <div style={{ fontSize: '24px' }}>‚òÄÔ∏è</div>
                          <div className="body-text" style={{ fontSize: '12px', color: '#5D4037', marginTop: '4px' }}>Light Brew</div>
                        </div>
                        <div style={{ padding: '16px 24px', borderRadius: '12px', background: '#2D2320', textAlign: 'center' }}>
                          <div style={{ fontSize: '24px' }}>üåô</div>
                          <div className="body-text" style={{ fontSize: '12px', color: '#F5E6D3', marginTop: '4px' }}>Dark Brew</div>
                        </div>
                      </div>
                      <p className="body-text" style={{ fontSize: '12px', color: '#8B7355', textAlign: 'center' }}>Tap the theme button in the header to switch</p>
                    </div>
                    <div style={{ padding: '16px 24px 24px', display: 'flex', gap: '12px' }}>
                      <button onClick={() => setOnboardingStep(2)} style={{ flex: 1, padding: '14px', borderRadius: '12px', background: 'transparent', border: '2px solid #D4C4A8', color: '#8B7355', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>‚Üê Back</button>
                      <button onClick={dismissOnboarding} style={{ flex: 1, padding: '14px', borderRadius: '12px', background: 'linear-gradient(145deg, #8B7355 0%, #6B5344 100%)', color: '#FFF8F0', border: 'none', fontFamily: "'Lora', serif", fontWeight: 600, cursor: 'pointer' }}>Let's Go! ‚òï</button>
                    </div>
                  </>
                )}
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
    setTimeout(() => document.getElementById('loadingScreen').classList.add('hidden'), 500);
  </script>

  <script>
    let deferredPrompt, newWorker;
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('sw.js');
          document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') reg.update(); });
          reg.addEventListener('updatefound', () => {
            newWorker = reg.installing;
            newWorker.addEventListener('statechange', () => { if (newWorker.state === 'installed' && navigator.serviceWorker.controller) document.getElementById('updateToast').classList.add('show'); });
          });
        } catch (e) { console.error('SW error:', e); }
      });
      navigator.serviceWorker.addEventListener('controllerchange', () => window.location.reload());
    }
    document.getElementById('updateBtn').onclick = () => { if (newWorker) newWorker.postMessage({ type: 'SKIP_WAITING' }); document.getElementById('updateToast').classList.remove('show'); };
    window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; setTimeout(() => document.getElementById('installBanner').classList.add('show'), 3000); });
    document.getElementById('installBtn').onclick = async () => { if (!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt = null; document.getElementById('installBanner').classList.remove('show'); };
    document.getElementById('closeBanner').onclick = () => { document.getElementById('installBanner').classList.remove('show'); sessionStorage.setItem('installBannerDismissed', 'true'); };
    if (window.matchMedia('(display-mode: standalone)').matches) document.getElementById('installBanner').style.display = 'none';
    
    const notifBanner = document.getElementById('notificationBanner');
    if ('Notification' in window && Notification.permission === 'default' && !sessionStorage.getItem('notifBannerDismissed')) setTimeout(() => notifBanner.classList.add('show'), 5000);
    document.getElementById('enableNotificationsBtn').onclick = async () => { await Notification.requestPermission(); notifBanner.classList.remove('show'); };
    document.getElementById('closeNotificationBanner').onclick = () => { notifBanner.classList.remove('show'); sessionStorage.setItem('notifBannerDismissed', 'true'); };
  </script>
</body>
</html>
